<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M-BOM Management System - Main</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link href="../css/dark-theme.css" rel="stylesheet">
    <link href="../css/ebom-notification.css" rel="stylesheet">
    <link href="../css/enhanced-features.css" rel="stylesheet">
    <link href="../css/layout-fix.css" rel="stylesheet">
    <link href="../css/level-visualization.css" rel="stylesheet">
    <link href="../css/hierarchy-visualization.css" rel="stylesheet">
    <link href="../css/main.css" rel="stylesheet">
    <link href="../css/globals.css" rel="stylesheet">
    <link href="../css/optimized-layout.css" rel="stylesheet">
    <link href="../css/dark-table-optimization.css" rel="stylesheet">
    <link href="../css/dark-grid-complete.css" rel="stylesheet">
    
    <!-- 기본 스타일 보장 -->
    <style>
        /* CSS 변수 정의 */
        :root {
            --vscode-editor-background: #1e1e1e;
            --vscode-sidebar-background: #252526;
            --vscode-panel-background: #252526;
            --vscode-input-background: #3c3c3c;
            --vscode-input-foreground: #cccccc;
            --vscode-input-border: #3c3c3c;
            --vscode-text-foreground: #cccccc;
            --vscode-text-secondary: #969696;
            --vscode-panel-border: #3c3c3c;
            --vscode-border: #3c3c3c;
            --vscode-button-background: #007acc;
            --vscode-button-foreground: #ffffff;
            --vscode-button-secondaryBackground: #5a5a5a;
            --vscode-button-secondaryForeground: #cccccc;
            --vscode-button-hoverBackground: #005a9e;
            --vscode-toolbar-hoverBackground: #2a2d2e;
            --vscode-list-hoverBackground: #2a2d2e;
        }
        
        /* 기본 레이아웃 스타일 */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: var(--vscode-editor-background);
            color: var(--vscode-text-foreground);
        }
        
        .app-container {
            display: flex;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }
        
        .sidebar {
            width: 250px;
            background: var(--vscode-sidebar-background);
            border-right: 1px solid var(--vscode-border);
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: auto;
            background: var(--vscode-editor-background);
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
            background: var(--vscode-button-background);
            color: var(--vscode-button-foreground);
        }
        
        .btn:hover {
            background: var(--vscode-button-hoverBackground);
        }
        
        .btn-primary {
            background: var(--vscode-button-background);
            color: var(--vscode-button-foreground);
        }
        
        .btn-secondary {
            background: var(--vscode-button-secondaryBackground);
            color: var(--vscode-button-secondaryForeground);
        }
        
        .form-input, .form-select {
            padding: 8px 12px;
            border: 1px solid var(--vscode-input-border);
            border-radius: 4px;
            background: var(--vscode-input-background);
            color: var(--vscode-input-foreground);
            font-size: 14px;
        }
        
        .bom-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--vscode-editor-background);
            color: var(--vscode-text-foreground);
        }
        
        .bom-table th,
        .bom-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid var(--vscode-border);
        }
        
        .bom-table th {
            background: var(--vscode-panel-background);
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .bom-table tr:hover {
            background: var(--vscode-list-hoverBackground);
        }
        
        /* 알림 컨테이너 */
        .ebom-notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            max-width: 400px;
            pointer-events: none;
        }
        
        .ebom-notification-container > * {
            pointer-events: auto;
        }
        
        .ebom-approval-notification {
            background: linear-gradient(135deg, #e8f5e8 0%, #f1f8e9 100%);
            border-left: 4px solid #4caf50;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.2);
            color: #2e7d32;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            opacity: 0;
        }
        
        .ebom-approval-notification.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: var(--vscode-editor-background);
            border: 1px solid var(--vscode-panel-border);
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--vscode-panel-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--vscode-panel-border);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--vscode-text-foreground);
            font-weight: 500;
        }
        
        /* 사이드바 스타일 */
        .sidebar-header {
            padding: 15px;
            border-bottom: 1px solid var(--vscode-border);
        }
        
        .search-box {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--vscode-input-border);
            border-radius: 4px;
            background: var(--vscode-input-background);
            color: var(--vscode-input-foreground);
            font-size: 14px;
        }
        
        .tree-container {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        
        /* 툴바 스타일 */
        .toolbar {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            border-bottom: 1px solid var(--vscode-border);
            background: var(--vscode-panel-background);
        }
        
        .toolbar .btn {
            margin: 0;
        }
        
        /* 컨트롤 패널 스타일 */
        .level-controls,
        .ebom-controls {
            margin: 10px 15px;
            padding: 15px;
            background: var(--vscode-panel-background);
            border: 1px solid var(--vscode-panel-border);
            border-radius: 8px;
        }
        
        .level-controls label,
        .ebom-controls h4 {
            color: var(--vscode-text-foreground);
            margin-bottom: 10px;
            display: block;
        }
        
        /* 연결 상태 표시 */
        .connection-status {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            background: #4caf50;
            color: white;
        }
        
        .connection-status.disconnected {
            background: #f44336;
        }
        
        /* 알림 아이콘 스타일 */
        #notification-indicator,
        .notification-indicator {
            position: fixed;
            top: 15px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: var(--vscode-button-background, #007acc);
            border-radius: 50%;
            display: flex !important;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            transition: all 0.3s;
        }

        #notification-indicator:hover {
            transform: scale(1.1);
            background: #0099ff;
        }

        .notification-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #f48771;
            color: white;
            min-width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex !important;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            padding: 0 4px;
        }

        /* 알림 리스트 패널 */
        .notification-list-panel {
            position: fixed;
            top: 65px;
            right: 20px;
            width: 350px;
            max-height: 500px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: none;
            z-index: 999;
            overflow: hidden;
        }

        .notification-list-panel.show {
            display: block;
        }

        .notification-list-header {
            padding: 15px;
            background: #f5f5f5;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-list-body {
            max-height: 400px;
            overflow-y: auto;
        }

        .notification-item {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.2s;
        }

        .notification-item:hover {
            background: #f8f8f8;
        }

        .notification-item.unread {
            background: #e3f2fd;
            font-weight: 500;
        }

        .notification-item .title {
            font-size: 14px;
            color: #333;
            margin-bottom: 4px;
        }

        .notification-item .time {
            font-size: 11px;
            color: #999;
        }

        .notification-item .type {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            margin-left: 5px;
        }

        .notification-item .type.approval {
            background: #4caf50;
            color: white;
        }

        .notification-item .type.research {
            background: #2196f3;
            color: white;
        }

        /* 그리드 컨테이너 */
        .grid-container {
            flex: 1;
            overflow: auto;
            padding: 15px;
        }
        
        .grid-wrapper {
            background: var(--vscode-editor-background);
            border: 1px solid var(--vscode-border);
            border-radius: 8px;
            overflow: auto;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <input type="text" class="search-box" placeholder="Search BOM..." id="searchInput">
            </div>
            <div class="tree-container" id="treeContainer">
                <!-- Tree will be dynamically generated -->
            </div>
            <div class="sidebar-toggle" onclick="mbomUI.toggleSidebar()" title="Toggle Sidebar">
                <i class="fas fa-chevron-left" id="sidebarToggleIcon"></i>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div class="header-title">
                    <i class="fas fa-cube"></i>
                    <span>M-BOM Management System</span>
                    <span style="color: var(--vscode-text-secondary); font-size: 11px; margin-left: 10px;">eBOM → M-BOM Synchronization</span>
                </div>
                <div class="header-controls">
                    <span style="color: var(--vscode-success); margin-right: 16px;">
                        <i class="fas fa-circle" style="font-size: 8px;"></i> Connected
                    </span>
                    <span style="color: var(--vscode-text-secondary); margin-right: 16px;">
                        <i class="fas fa-user"></i> <span id="currentUser"></span>
                    </span>
                    <button class="btn btn-icon" onclick="authManager.logout()">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>

            <!-- Toolbar -->
            <div class="toolbar">
                <button class="btn" id="btnAddRow">
                    <i class="fas fa-plus"></i> Add Row
                </button>
                <button class="btn" id="btnSave">
                    <i class="fas fa-save"></i> Save
                </button>
                <button class="btn btn-primary" id="btnSubmitApproval" onclick="mbomUI.openApprovalModal()">
                    <i class="fas fa-paper-plane"></i> 결재 요청
                </button>
                <button class="btn btn-secondary" id="btnExport">
                    <i class="fas fa-file-excel"></i> Export
                </button>
                <div style="margin-left: auto; display: flex; gap: 8px;">
                    <button class="btn btn-icon btn-secondary" id="btnRefresh">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button class="btn btn-icon btn-secondary" id="btnFullscreen">
                        <i class="fas fa-expand"></i>
                    </button>
                    <button class="btn btn-icon btn-secondary" id="btnTogglePanel">
                        <i class="fas fa-info-circle"></i>
                    </button>
                </div>
            </div>

            <!-- 통합 컨트롤 패널 -->
            <div class="unified-controls" style="padding: 10px 15px; background: var(--vscode-panel-background); border-radius: 4px; margin-bottom: 10px;">
                <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
                    <!-- E-BOM 연동 섹션 -->
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-link" style="color: #007acc;"></i>
                        <button onclick="mbomUI.syncFromEBOM()" class="btn btn-sm" style="padding: 5px 10px; font-size: 12px;">
                            <i class="fas fa-download"></i> E-BOM 동기화
                        </button>
                        <button onclick="mbomUI.compareWithEBOM()" class="btn btn-sm btn-secondary" style="padding: 5px 10px; font-size: 12px;">
                            <i class="fas fa-balance-scale"></i> 비교
                        </button>
                    </div>

                    <!-- 레벨 설정 섹션 -->
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <label style="font-size: 12px; color: var(--vscode-text-secondary);">레벨:</label>
                        <select id="levelColumns" onchange="mbomUI.updateLevelColumns(this.value)" style="padding: 3px 6px; font-size: 12px;">
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5" selected>5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                        </select>
                        <span style="font-size: 11px; color: var(--vscode-text-secondary);">
                            최대: <span id="currentMaxLevel">4</span>
                        </span>
                    </div>

                    <!-- 상태 표시 -->
                    <div style="margin-left: auto; display: flex; align-items: center; gap: 15px;">
                        <span id="ebomConnectionStatus" style="font-size: 11px; color: #4caf50;">
                            <i class="fas fa-circle" style="font-size: 6px;"></i> 연결됨
                        </span>
                        <span style="font-size: 11px; color: var(--vscode-text-secondary);">
                            동기화: <span id="lastSyncTime">-</span>
                        </span>
                    </div>
                </div>
            </div>

            <!-- Grid Container -->
            <div class="grid-container">
                <div class="grid-wrapper" id="gridWrapper">
                    <table class="bom-table" id="bomTable">
                        <thead>
                            <!-- 테이블 헤더는 JavaScript에서 동적으로 생성됩니다 -->
                        </thead>
                        <tbody id="bomTableBody">
                            <!-- Table rows will be dynamically generated -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Status Bar -->
            <div class="status-bar">
                <div class="status-item">
                    <i class="fas fa-database"></i>
                    <span id="totalItems">0</span> items
                </div>
                <div class="status-item">
                    <i class="fas fa-edit"></i>
                    <span id="modifiedCount">0</span> modified
                </div>
                <div class="status-item">
                    <i class="fas fa-clock"></i>
                    <span id="lastSaved">Never</span>
                </div>
                <div class="status-item" style="margin-left: auto;">
                    <span id="autoSaveStatus">Auto-save: ON</span>
                </div>
            </div>
        </div>

        <!-- Property Panel (Slide-in Overlay) -->
        <div class="property-overlay" id="propertyOverlay" style="display: none;">
            <div class="property-panel-slide">
                <div class="property-header">
                    <span>Properties</span>
                    <button class="btn-close" onclick="mbomUI.closePropertyPanel()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="property-content" id="propertyContent">
                    <!-- Properties will be dynamically loaded -->
                </div>
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div class="context-menu" id="contextMenu" style="display: none;">
        <div class="context-menu-item" data-action="edit">
            <i class="fas fa-pen"></i> 셀 편집
        </div>
        <div class="context-menu-item" data-action="edit-row">
            <i class="fas fa-edit"></i> 행 편집 (모달)
        </div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" data-action="add-child">
            <i class="fas fa-plus"></i> 하위 항목 추가
        </div>
        <div class="context-menu-item" data-action="duplicate">
            <i class="fas fa-copy"></i> 복제
        </div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" data-action="delete">
            <i class="fas fa-trash"></i> 삭제
        </div>
        <div class="context-menu-item" data-action="export">
            <i class="fas fa-file-export"></i> 내보내기
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- Edit Row Modal -->
    <div id="editRowModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>행 편집</h3>
                <button class="modal-close" onclick="mbomUI.closeEditModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="editRowForm">
                    <div class="form-group">
                        <label for="editPartNumber">Part Number:</label>
                        <input type="text" id="editPartNumber" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="editDescription">Part Name:</label>
                        <input type="text" id="editDescription" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="editLevel">Level:</label>
                        <select id="editLevel" class="form-select">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editQuantity">Quantity:</label>
                        <input type="number" id="editQuantity" class="form-input" min="0" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="editUnit">Unit:</label>
                        <select id="editUnit" class="form-select">
                            <option value="EA">EA</option>
                            <option value="SET">SET</option>
                            <option value="KG">KG</option>
                            <option value="M">M</option>
                            <option value="L">L</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editMaterial">Material:</label>
                        <input type="text" id="editMaterial" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="editWeight">Weight:</label>
                        <input type="number" id="editWeight" class="form-input" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="editSupplier">Supplier:</label>
                        <input type="text" id="editSupplier" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="editCost">Cost:</label>
                        <input type="number" id="editCost" class="form-input" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="editLeadTime">Lead Time:</label>
                        <input type="number" id="editLeadTime" class="form-input" min="0">
                    </div>
                    <div class="form-group">
                        <label for="editStatus">Status:</label>
                        <select id="editStatus" class="form-select">
                            <option value="pending">대기</option>
                            <option value="approved">승인</option>
                            <option value="review">검토</option>
                            <option value="modified">수정</option>
                            <option value="rejected">거부</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="mbomUI.closeEditModal()">취소</button>
                <button type="button" class="btn btn-primary" onclick="mbomUI.saveEditRow()">저장</button>
            </div>
        </div>
    </div>

    <!-- 결재 모달 -->
    <div id="approvalModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>M-BOM 결재 요청</h3>
                <button class="modal-close" onclick="mbomUI.closeApprovalModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="approvalForm">
                    <div class="form-group">
                        <label for="approvalTitle">결재 제목:</label>
                        <input type="text" id="approvalTitle" class="form-input" placeholder="M-BOM 결재 요청" required>
                    </div>
                    <div class="form-group">
                        <label for="approvalDescription">결재 사유:</label>
                        <textarea id="approvalDescription" class="form-input" rows="4" placeholder="M-BOM 변경 사유를 입력하세요..." required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="approvalPriority">우선순위:</label>
                        <select id="approvalPriority" class="form-select">
                            <option value="normal">보통</option>
                            <option value="high">높음</option>
                            <option value="urgent">긴급</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="approvalReviewer">검토자:</label>
                        <select id="approvalReviewer" class="form-select" required>
                            <option value="">검토자를 선택하세요</option>
                            <option value="manager1">김매니저</option>
                            <option value="manager2">이팀장</option>
                            <option value="director1">박이사</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="approvalApprover">최종 승인자:</label>
                        <select id="approvalApprover" class="form-select" required>
                            <option value="">승인자를 선택하세요</option>
                            <option value="director1">박이사</option>
                            <option value="ceo">최대표</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="mbomUI.closeApprovalModal()">취소</button>
                <button type="button" class="btn btn-primary" onclick="mbomUI.submitApproval()">결재 요청</button>
            </div>
        </div>
    </div>

    <!-- 결재 상태 표시 -->
    <div id="approvalStatus" class="approval-status" style="display: none;">
        <div class="status-header">
            <i class="fas fa-clipboard-check"></i>
            <span>결재 상태</span>
        </div>
        <div class="status-content">
            <div class="status-item">
                <span class="status-label">현재 상태:</span>
                <span id="currentApprovalStatus" class="status-value">-</span>
            </div>
            <div class="status-item">
                <span class="status-label">요청일:</span>
                <span id="approvalRequestDate" class="status-value">-</span>
            </div>
            <div class="status-item">
                <span class="status-label">검토자:</span>
                <span id="approvalReviewerName" class="status-value">-</span>
            </div>
            <div class="status-item">
                <span class="status-label">승인자:</span>
                <span id="approvalApproverName" class="status-value">-</span>
            </div>
        </div>
    </div>

    <!-- E-BOM 설정 모달 -->
    <div id="ebomConfigModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>E-BOM 연동 설정</h3>
                <button class="modal-close" onclick="mbomUI.closeEBOMConfigModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="ebomConfigForm">
                    <div class="form-group">
                        <label for="ebomServerUrl">E-BOM 서버 URL:</label>
                        <input type="url" id="ebomServerUrl" class="form-input" placeholder="https://ebom.company.com/api" required>
                    </div>
                    <div class="form-group">
                        <label for="ebomProjectId">프로젝트 ID:</label>
                        <input type="text" id="ebomProjectId" class="form-input" placeholder="PROJECT-001" required>
                    </div>
                    <div class="form-group">
                        <label for="ebomRevision">리비전:</label>
                        <select id="ebomRevision" class="form-select" required>
                            <option value="">리비전을 선택하세요</option>
                            <option value="1.0">1.0 (최신)</option>
                            <option value="0.9">0.9</option>
                            <option value="0.8">0.8</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="autoSyncEnabled">자동 동기화:</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="autoSyncEnabled" class="form-checkbox">
                            <span style="color: var(--vscode-text-secondary); font-size: 14px;">
                                E-BOM 변경 시 자동으로 알림받기
                            </span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="syncFrequency">동기화 주기:</label>
                        <select id="syncFrequency" class="form-select">
                            <option value="manual">수동</option>
                            <option value="5min">5분마다</option>
                            <option value="15min">15분마다</option>
                            <option value="30min">30분마다</option>
                            <option value="1hour">1시간마다</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="mbomUI.closeEBOMConfigModal()">취소</button>
                <button type="button" class="btn btn-primary" onclick="mbomUI.saveEBOMConfig()">저장</button>
                <button type="button" class="btn btn-secondary" onclick="mbomUI.testEBOMConnection()">연결 테스트</button>
            </div>
        </div>
    </div>

    <!-- E-BOM 비교 모달 -->
    <div id="ebomCompareModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 90%; width: 1200px;">
            <div class="modal-header">
                <h3>E-BOM과 M-BOM 비교</h3>
                <button class="modal-close" onclick="mbomUI.closeEBOMCompareModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="compare-container">
                    <div class="compare-section">
                        <h4>E-BOM 데이터</h4>
                        <div id="ebomDataDisplay" class="data-display"></div>
                    </div>
                    <div class="compare-section">
                        <h4>M-BOM 데이터</h4>
                        <div id="mbomDataDisplay" class="data-display"></div>
                    </div>
                </div>
                <div class="compare-actions" style="margin-top: 20px; text-align: center;">
                    <button class="btn btn-primary" onclick="mbomUI.applyEBOMChanges()">
                        <i class="fas fa-arrow-right"></i> E-BOM 변경사항 적용
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- eBOM Changes Dashboard -->
    <div id="ebomChangesDashboard">
        <div class="dashboard-header">
            <h3>eBOM 변경 대시보드</h3>
            <button class="btn btn-icon" onclick="if(typeof ebomNotifications !== 'undefined' && ebomNotifications.dismissDashboard) { ebomNotifications.dismissDashboard(); } else { this.closest('.dashboard-header').parentElement.style.display='none'; }">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div id="dashboardContent">
            <!-- Dashboard content will be rendered here -->
        </div>
    </div>

    <script src="../js/auth.js"></script>
    <script src="../js/mbom-core.js"></script>
    <script src="../js/toast-notifications.js"></script>
    <script src="../js/notification-manager.js"></script>
    <script src="../js/ebom-monitor.js"></script>
    <script src="../js/ebom-notification.js"></script>
    <script src="../js/menu-bar.js"></script>
    <!-- <script src="../js/grid-resize.js"></script> Temporarily disabled for testing -->
    <script src="../js/drawing-preview.js"></script>
    <!-- level-display.js removed - conflicts with table structure -->
    <!-- mbom-ui.js must be loaded last to ensure proper rendering -->
    <script src="../js/column-resize.js"></script>
    <script src="../js/column-control-panel.js"></script>
    <script src="../js/pixel-popup.js"></script>
    <!-- User-specific level settings management -->
    <script src="../js/user-level-settings.js"></script>
    <script src="../js/pixel-notification-system.js"></script>
    <script src="../js/dynamic-level-system.js"></script>
    <script src="../js/advanced-level-manager.js"></script>
    <script src="../js/inline-properties.js"></script>
    <script src="../js/sidebar-notifications.js"></script>
    <script src="../js/peek-notification-panel.js"></script>
    <script src="../js/statusbar-notification-system.js"></script>
    <script src="../js/unified-notification-manager.js"></script>
    <!-- AG Charts for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/ag-charts-community@latest/dist/ag-charts-community.min.js"></script>
    <script src="../js/ebom-sync-dashboard-compact.js"></script>
    <script src="../js/revision-management-dashboard.js"></script>
    <script src="../js/analysis-dashboard.js"></script>
    <script src="../js/mbom-ui.js"></script>
    <!-- Level header controls must be loaded after mbom-ui.js -->
    <script src="../js/level-header-controls.js"></script>

    <!-- Tree-Grid Sync -->
    <!-- <script src="../js/tree-grid-sync.js"></script> -->

    <!-- 동기화 시스템 -->
    <script src="../js/simple-sync.js"></script>
    <!-- drag-sync.js 제거 - advanced-level-manager.js와 충돌 -->
    <!-- <script src="../js/drag-sync.js"></script> -->

    <!-- 새로운 중앙 상태 관리 시스템 (테스트용, 비활성화) -->
    <!--
    <script src="../js/bom-state-manager.js"></script>
    <script src="../js/tree-connector.js"></script>
    <script src="../js/grid-connector.js"></script>
    <script src="../js/sync-test.js"></script>
    -->

    <script src="../js/notification-integration.js"></script>
    <script src="../js/keyboard-shortcuts.js"></script>
    <script src="../js/status-filter.js"></script>
    <script src="../js/enhanced-table-search.js"></script>

    <!-- Edit Modal Styles -->
    <link rel="stylesheet" href="../css/edit-modal.css">

</body>
</html>